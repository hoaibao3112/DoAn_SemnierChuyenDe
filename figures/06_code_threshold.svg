<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="616" viewBox="0 0 1200 616">
<rect width="100%" height="100%" fill="#fff"/>
<style>.mono{font:14px/1.2 "Courier New", monospace; fill:#111}</style>
<text x="20" y="24" class="mono">Hình 6 — Đoạn mã (STAR2SENT, threshold, predict_sentiment) trích từ nlp.py</text>
<text x="12" y="50" class="mono">STAR2SENT = {</text>
<text x="12" y="68" class="mono">    "1 star": "NEGATIVE",</text>
<text x="12" y="86" class="mono">    "2 stars": "NEGATIVE",</text>
<text x="12" y="104" class="mono">    "3 stars": "NEUTRAL",</text>
<text x="12" y="122" class="mono">    "4 stars": "POSITIVE",</text>
<text x="12" y="140" class="mono">    "5 stars": "POSITIVE"</text>
<text x="12" y="158" class="mono">}</text>
<text x="12" y="176" class="mono"></text>
<text x="12" y="194" class="mono"># Cache the pipeline (singleton pattern)</text>
<text x="12" y="212" class="mono">@functools.lru_cache(maxsize=1)</text>
<text x="12" y="230" class="mono">def get_sentiment_pipeline():</text>
<text x="12" y="248" class="mono">    """</text>
<text x="12" y="266" class="mono">    Load and cache the Hugging Face sentiment analysis pipeline.</text>
<text x="12" y="284" class="mono">    This ensures the model is loaded only once.</text>
<text x="12" y="302" class="mono">    """</text>
<text x="12" y="320" class="mono">    return pipeline(</text>
<text x="12" y="338" class="mono">        "sentiment-analysis",</text>
<text x="12" y="356" class="mono">        model="nlptown/bert-base-multilingual-uncased-sentiment",</text>
<text x="12" y="374" class="mono">        truncation=True,</text>
<text x="12" y="392" class="mono">        max_length=256</text>
<text x="12" y="410" class="mono">    )</text>
<text x="12" y="428" class="mono"></text>
<text x="12" y="446" class="mono"></text>
<text x="12" y="464" class="mono">def _lexicon_adjust(text: str, sentiment: str, score: float, neutral_threshold: float = 0.50) -&gt; str:</text>
<text x="12" y="482" class="mono">    """Adjust sentiment using simple keyword heuristics when model is uncertain.</text>
<text x="12" y="500" class="mono"></text>
<text x="12" y="518" class="mono">    Rules:</text>
<text x="12" y="536" class="mono">    - If model predicts POSITIVE but a negative key</text>
</svg>